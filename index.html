<!DOCTYPE html>
<html lang="cs">
<head>
	<title></title>
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<script>
const images = ["jedna.jpg", "dva.jpg", "tri.jpg", "ctyri.jpg"]

const classification = {}
const ui = {}
const keyMap = new Map()

qel = (query) => document.querySelector(query)
gel = (id) => document.getElementById(id)

function cel(name, parameters={}) {
	var element = document.createElement(name)
	for (const param in parameters) {
		element[param] = parameters[param]
	}
	return element
}

function setRadio(radioList, value) {
	if (value === undefined) {
		for (const radio of radioList) {
			radio.checked = false
		}
	} else {
		radioList.value = value
	}
}

function setValue(side, value) {
	const filename = ui.select.value
	const current = classification[filename]
	current[side] = Number(value)
	setRadio(ui.form.elements[side], value)
}

function changeImage() {
	const filename = ui.select.value
	ui.img.src = filename
	if (classification[filename] === undefined) {
		classification[filename] = {}
	}
	const current = classification[filename]
	setRadio(ui.form.elements.left, current.left)
	setRadio(ui.form.elements.right, current.right)
}

function downloadClick(ev) {
	const data = JSON.stringify(classification)
	ui.download.href = `data:application/json,${data}`
}

function radioChange(ev) {
	const filename = ui.select.value
	const current = classification[filename]
	if (ui.form.elements.left.value) {
		current.left = Number(ui.form.elements.left.value)
	}
	if (ui.form.elements.right.value) {
		current.right = Number(ui.form.elements.right.value)
	}
}

function keyDown(ev) {
	if (keyMap.has(ev.key)) {
		ev.preventDefault()
		keyMap.get(ev.key)()
	}
}

function prevClick(ev) {
	ui.select.selectedIndex = Math.max(0, ui.select.selectedIndex - 1)
	changeImage()
}

function nextClick(ev) {
	ui.select.selectedIndex = Math.min(ui.select.length - 1, ui.select.selectedIndex + 1)
	changeImage()
}

function setKeyMap() {
	const keys = [
		['q', setValue, "left", 0],
		['w', setValue, "left", 1],
		['e', setValue, "left", 2],
		['r', setValue, "left", 3],
		['a', setValue, "right", 0],
		['s', setValue, "right", 1],
		['d', setValue, "right", 2],
		['f', setValue, "right", 3],
		['ArrowLeft', prevClick],
		['ArrowRight', nextClick],
	]
	for (const [key, fn, ...args] of keys) {
		keyMap.set(key, fn.bind(null, ...args))
	}
}

window.onload = () => {
	ui.select = qel("select")
	ui.img = qel("img")
	ui.download = gel("download")
	ui.form = qel("form")
	for (const filename of images) {
		ui.select.appendChild(cel("option", {textContent: filename, value: filename}))
	}
	ui.select.oninput = changeImage
	ui.download.onclick = downloadClick
	for (const radio of document.querySelectorAll("input")) {
		radio.onchange = radioChange
	}
	setKeyMap()
	document.onkeydown = keyDown
	gel("prev").onclick = prevClick
	gel("next").onclick = nextClick
	changeImage()
}

</script>
<style>
body {
	display: flex;
	flex-flow: column;
	align-items: center;
}
.hflex {
	display: flex;
	flex-flow: row;
	align-items: center;
}
.vflex>* {
	display: block;
}
</style>
</head>
<body>
<label>Zobrazený soubor:
<button id="prev">〈</button>
<select>
</select>
<button id="next">〉</button>
</label>
<form action="javascript:void(0);">
<div class=hflex>
	<div class=vflex>
		<label><input type=radio name=left value=0>Hodně ostré (0)</label>
		<label><input type=radio name=left value=1>Ostré (1)</label>
		<label><input type=radio name=left value=2>Tupé  (2)</label>
		<label><input type=radio name=left value=3>Hodně tupé (3)</label>
	</div>
	<img src="jedna.jpg">
	<div class=vflex>
		<label><input type=radio name=right value=0>Hodně ostré (0)</label>
		<label><input type=radio name=right value=1>Ostré (1)</label>
		<label><input type=radio name=right value=2>Tupé  (2)</label>
		<label><input type=radio name=right value=3>Hodně tupé (3)</label>
	</div>
</div>
</form>
<a id="download" download="hlasivky.json">
<button>Uložit klasifikaci...</button>
</a>
</body>
</html>
